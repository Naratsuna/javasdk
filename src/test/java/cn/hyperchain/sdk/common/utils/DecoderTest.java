package cn.hyperchain.sdk.common.utils;

import cn.hyperchain.sdk.bvm.OperationResult;
import cn.hyperchain.sdk.bvm.Result;
import cn.hyperchain.sdk.common.protos.ProposalOuterClass;
import com.google.protobuf.InvalidProtocolBufferException;
import org.junit.Assert;
import org.junit.Test;

import java.util.List;

public class DecoderTest {

    @Test
    public void decodeHVM() {
        String hex = "0x73756363657373";
        String result = Decoder.decodeHVM(hex, String.class);
        Assert.assertEquals("success", result);
    }

    @Test
    public void testDecode(){
        // flato 1.0.1
//        String ret = "0x7b2253756363657373223a747275652c22526574223a225b7b5c22636f64655c223a3230307d2c7b5c22636f64655c223a3230307d2c7b5c22636f64655c223a3230307d2c7b5c22636f64655c223a3230307d2c7b5c22636f64655c223a3230307d2c7b5c22636f64655c223a3230307d2c7b5c22636f64655c223a3230307d2c7b5c22636f64655c223a3230307d2c7b5c22636f64655c223a3230307d5d222c22457272223a22227d";
        // flato 1.0.0
        String ret = "0x7b2253756363657373223a747275652c22526574223a22573373695932396b5a5349364d6a417766537837496d4e765a4755694f6a49774d48307365794a6a6232526c496a6f794d4442394c4873695932396b5a5349364d6a41776656303d222c22457272223a22227d";
        Result result = Decoder.decodeBVM(ret);
        List<OperationResult> operationResults = Decoder.decodeBVMResult((String) result.getRet());
        for (OperationResult or : operationResults){
            System.out.println(or);
        }
    }

    @Test
    public void encodeProposal() throws InvalidProtocolBufferException {
        String log = "08011284030000000a0000000f53657446696c746572456e61626c65000000010000000566616c73650000000e53657446696c74657252756c6573000000010000001f5b7b22616c6c6f775f616e796f6e65223a66616c73652c226964223a307d5d00000015536574436f6e73656e737573426174636853697a65000000010000000331303000000014536574436f6e73656e737573506f6f6c53697a65000000010000000332303000000013536574436f6e73656e73757353657453697a65000000010000000235300000001453657450726f706f73616c5468726573686f6c640000000100000001340000001253657450726f706f73616c54696d656f7574000000010000000c3438303030303030303030300000001253657450726f706f73616c54696d656f7574000000010000000c34383030303030303030303000000018536574436f6e7472616374566f74655468726573686f6c6400000001000000013300000015536574436f6e7472616374566f7465456e61626c6500000001000000047472756518d0bbb4bbebcec4d11620d0abc786c9d7c4d116280132720a2a3078303030663161376130386363633438653564333066383038353063663163663238336161336162641242307831366133313237363930393565323832633130323861376138376634336563623864623937653765643166386234663466626438393435356363353266386666180140064801522a3078303030663161376130386363633438653564333066383038353063663163663238336161336162645a05302e312e30";
        ProposalOuterClass.Proposal proposal = Decoder.decodeProposalLog(log);
        System.out.println(proposal.toString());
    }
}